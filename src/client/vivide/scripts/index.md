# User-defined Vivide Content

<span style="color: red; font-weight: bold;">CAUTION!</span>
Press the button to delete the corresponding file:

<script>
import { scriptFolder, stepFolder } from 'src/client/vivide/utils.js'
import { fileName, flatten } from 'utils';

(async () => {
  let autoGenerated = /(.*-template\.js(on)?$)|(.md?$)/;
  let deleteFunctions = [];
  let folders = [scriptFolder, stepFolder];
  let fileNames = (await Promise.all(folders.map(async folderURL => {
    let folder = JSON.parse(await lively.files.statFile(folderURL));
    let filenames = folder.contents
      .filter(({ type }) => type === 'file')
      .map(({ name }) => name)
      .filter(name => !autoGenerated.test(name));
    lively.notify(filenames)
    return filenames;
  })));
  let buttonList = fileNames.map((folder, i) => <div>
  <h5>{folders[i].split('/')[folders[i].split('/').length-2]}/</h5>
  {...folder.map(urlString => {
    let del = async evt => {
      let delResponse = await fetch(urlString, { method: 'DELETE' });
      if (delResponse.status === 200) {
        lively.success(`deleted file ${urlString::fileName()}`);
        button.remove();
        deleteFunctions = deleteFunctions.filter(df => df !== del);
      } else {
        lively.notify("could not properly delete " + urlString, (await delResponse.text()));
      }
    }
    deleteFunctions.push(del);
    let delbutton = <button click={del}>
      <span style="color: red; font-weight: bold;">Open</span>
    </button>;
    
    let openbutton = <button click={del}>
      <span style="color: blue; font-weight: bold;">Delete</span>
    </button>;

    return <div>{urlString} {delbutton} {openbutton}</div>;
  })}</div>);
  
  let deleteAllScriptsButton = <button click={async evt => {
    await Promise.all(deleteFunctions.map(f => f()));
    lively.success('removed all scripts');
  }}><span style="color: red; font-weight: bold;">DELETE ALL SCRIPTS!</span></button>;

  return <div>
    {deleteAllScriptsButton}
    <div>{...buttonList}</div>
  </div>;
})();
</script>